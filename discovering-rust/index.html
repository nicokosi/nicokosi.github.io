<!DOCTYPE html>
<html lang="en" class="dark light">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    

    
    
    
    <title>
         Discovering Rust
        
    </title>

        
            <meta property="og:title" content="Discovering Rust" />
        
     

     
         
             <meta property="og:description" content="Discovering the Rust programming language, from a Java&#x2F;Clojure programmer&#x27;s point of view, via a small side project." />
         
     

     
         
             <meta name="description" content="Discovering the Rust programming language, from a Java&#x2F;Clojure programmer&#x27;s point of view, via a small side project." />
         
    

    
    

    
    
        <link href=https://nicokosi.github.io/fonts.css rel="stylesheet" />
    

    
    

    
    

    
    

    
    

    

    
    <link rel="alternate" type="application/atom+xml" title="" href="https://nicokosi.github.io/atom.xml">


    
    
        <link rel="stylesheet" type="text/css" href=https://nicokosi.github.io/theme/light.css />
        <link rel="stylesheet" type="text/css" href="https://nicokosi.github.io/theme/dark.css" media="(prefers-color-scheme: dark)" />
    

    <!-- Set the correct theme in the script -->
    <script src=https://nicokosi.github.io/js/themetoggle.js></script>
    
        <script>
            if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                setTheme("dark");
            } else {
                setTheme("light");
            }
        </script>
    

    <link rel="stylesheet" type="text/css" media="screen" href=https://nicokosi.github.io/main.css />

    
    <script src=https://nicokosi.github.io/js/mermaid.js></script>
</head>


<body>
    <div class="content">
        <header>
    <div class="main">
        
        <a href=https:&#x2F;&#x2F;nicokosi.github.io></a>
        

        <div class="socials">
            
            <a rel="me" href="https:&#x2F;&#x2F;fosstodon.org&#x2F;@nicokosi" class="social">
                <img alt=mastodon src=https://nicokosi.github.io/social_icons/mastodon.svg>
            </a>
            
            <a rel="me" href="https:&#x2F;&#x2F;bsky.app&#x2F;profile&#x2F;nicokosi.bsky.social" class="social">
                <img alt=bluesky src=https://nicokosi.github.io/social_icons/bluesky.svg>
            </a>
            
            <a rel="me" href="https:&#x2F;&#x2F;github.com&#x2F;nicokosi&#x2F;" class="social">
                <img alt=github src=https://nicokosi.github.io/social_icons/github.svg>
            </a>
            
        </div>
    </div>

    <nav>
        
        <a href=https://nicokosi.github.io style="margin-left: 0.5em">&#x2F;posts</a>
        
        <a href=https://nicokosi.github.io/tags style="margin-left: 0.5em">&#x2F;tags</a>
        

        
    </nav>
</header>


        
        
    
<main>
    <article>
        <div class="title">
            
            
    <div class="page-header">
        Discovering Rust<span class="primary-color" style="font-size: 1.6em">.</span>
    </div>


                <div class="meta">
                    
                        Posted on <time>2018-06-10</time>
                    

                    

                    

                    
                    
                            <span class="tags-label"> :: Tags:</span>
                            <span class="tags">
                                    <a href="https://nicokosi.github.io/tags/rust/" class="post-tag">rust</a>
                                
                            </span>
                    

                    
                    

                    

                </div>
        </div>

        

        
        

        <section class="body">
            <h1 id="discovering-rust">Discovering Rust</h1>
<p><em>As a Java developer, I want to learn bits of Rust, so that I can deeply understand this sentence quoted from <a href="https://www.rust-lang.org">rust-lang.org</a>*:</em></p>
<blockquote>
<p>Rust is a systems programming language that runs blazingly <strong>fast</strong>, <strong>prevents segfaults</strong>, and <strong>guarantees thread safety</strong></p>
</blockquote>
<p>*: did you notice the "agile stories meme"? ðŸ˜‰</p>
<h2 id="how-i-started-learning-rust">How I started learning Rust</h2>
<p><a href="https://doc.rust-lang.org/stable/book/second-edition/">The Rust Programming Language (2nd edition)</a> is a great free on-line book with pragmatic examples and small projects that are progressively implemented (a CLI tool and a web server).</p>
<p>After reading parts of this book, I ported a personal project named <a href="https://github.com/nicokosi/hubstats">hubstats</a> from Clojure to Rust. Hubstats is a command line tool I wrote in Clojure that calls GitHub API and displays pull requests summaries in the standard output. I just converted this project in Rust: <a href="https://github.com/nicokosi/pullpito/">pullpito</a>.</p>
<p>Porting existing code was an enjoyable way to learn Rust since I did not had to think about the "what" (display pull requests information) and the "how" (call the GitHub API): I just had to focus on Rust coding!</p>
<h2 id="my-first-impressions">My first impressions</h2>
<p>Rust code runs <strong>fast</strong>! For instance, let's compare running a few <code>pullpito</code>'s unit tests that run in half a second:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>pullpito $&gt; time (cargo test --quiet)
</span><span>
</span><span>running 8 tests
</span><span># snip
</span><span>test result: ok. 8 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
</span><span>
</span><span>( cargo test --quiet; )  0.43s user 0.21s system 96% cpu 0.665 total
</span></code></pre>
<p>On the other hand, <code>hubstats</code>' tests run in 10 seconds:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>hubstats $&gt; time (lein test)
</span><span># snip
</span><span>
</span><span>Ran 3 tests containing 20 assertions.
</span><span>0 failures, 0 errors.
</span><span>( lein test; )  10.86s user 0.70s system 129% cpu 8.923 total
</span></code></pre>
<p><em>Note: the <code>cargo</code> command launches <a href="https://github.com/rust-lang/cargo/">Cargo</a> which is Rust's build tool ; the <code>lein</code> command launches <a href="https://leiningen.org/">Leiningen</a> which is Clojure's build tool</em>.</p>
<p>Now let's compare the CLI tool executions. <code>pullpito</code> runs in 20 milliseconds:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>pullpito $&gt; time (cargo run --quiet python/peps)
</span><span>pull requests for &quot;python/peps&quot; -&gt;
</span><span>  opened per author:
</span><span>    brainwane: 1
</span><span>  commented per author:
</span><span>    the-knights-who-say-ni: 1
</span><span>    stevendaprano: 2
</span><span>    pradyunsg: 2
</span><span>    gvanrossum: 1
</span><span>    6502: 1
</span><span>    Rosuav: 1
</span><span>    brainwane: 1
</span><span>  closed per author:
</span><span>    markshannon: 1
</span><span>
</span><span>( cargo run --quiet python/peps; )  0.22s user 0.09s system 20% cpu 1.524 total
</span></code></pre>
<p>...whereas <code>hubstats</code> runs in 11 seconds (it should probably be optimized ðŸ˜‡):</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>hubstats $&gt; time (lein run --organization python --repository peps)
</span><span>pull requests for python/peps -&gt;
</span><span>	since 2018-05-15T05:35:57Z
</span><span>		8 opened / 8 closed / 2 commented (15 comments)
</span><span> 		opened per author:  {encukou 2, willingc 1, jdemeyer 1, gvanrossum 1, ethanhs 1, daxm 1, brainwane 1}
</span><span> 		comments per author:  {tim-one 4, ethanhs 3, vlasovskikh 2, gvanrossum 2, JelleZijlstra 2, ilevkivskyi 1, Rosuav 1}
</span><span> 		closed per author:  {brettcannon 4, markshannon 3, encukou 1}
</span><span>( lein run --organization python --repository peps; )  11.30s user 0.77s system 66% cpu 18.160 total
</span></code></pre>
<p>What about <strong>compilation</strong>? The first compilation is slow because all dependencies have to be compiled. For instance, <code>pullpito</code> initially compiles in 40 seconds, on my machine:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>pullpito $&gt; time (cargo clean &amp;&amp; cargo build)
</span><span>Compiling void v1.0.2
</span><span>   Compiling byteorder v1.2.2
</span><span>   Compiling serde v1.0.37
</span><span>   Compiling scoped-tls v0.1.
</span><span># snip
</span><span>    Finished dev [unoptimized + debuginfo] target(s) in 41.53 secs
</span><span>( cargo clean &amp;&amp; cargo build; )  213.99s user 16.77s system 552% cpu 41.788 total
</span></code></pre>
<p>But Rust has an incremental compiler, so subsequent compilations will be immediate if code does not change:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>pullpito $&gt; cargo build
</span><span>    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs
</span></code></pre>
<p>On the other hand, <code>hubstats</code> compiles in 40 seconds (dependencies are not compiled):</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>hubstats $&gt; time (lein clean &amp;&amp; lein uberjar)
</span><span># snip
</span><span>( lein clean &amp;&amp; lein uberjar; )  37.55s user 6.49s system 223% cpu 19.750 total
</span></code></pre>
<br/>
## About Rust, the language
<br/>
### Ownership, OMG! ðŸ˜±
<p>Rust has a particular way to manage memory. Instead of using a garbage collector like Java or manual management like C/C++, allocated memory is automatically cleaned using the <a href="https://doc.rust-lang.org/book/second-edition/ch04-01-what-is-ownership.html">"ownership" rules</a>:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>    Each value in Rust has a variable thatâ€™s called its owner.
</span><span>    There can only be one owner at a time.
</span><span>    When the owner goes out of scope, the value will be dropped.
</span></code></pre>
<p>It seems easy, but in reality, all the implications are hard to understand!</p>
<p>Since I have not fully understood the ownership implications, I will not go any further on this topic. My current status is: fix all the compilation errors! ðŸ˜‡</p>
<p>Feel free to read more about it in the chapter <a href="https://doc.rust-lang.org/book/second-edition/ch04-00-understanding-ownership.html">"Understanding Ownership"</a> of "The Rust Programming Language".</p>
<br/>
### Immutability by default ðŸ˜Ž
<p>A variable is immutable, by default. It cannot be re-assigned unless explicitly declared mutable:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">let</span><span> name = &quot;</span><span style="color:#a3be8c;">foo</span><span>&quot;;
</span><span style="color:#65737e;">// name = &quot;bar&quot;; // Would trigger this compilation error: &quot;error: re-assignment of immutable variable&quot;
</span><span>
</span><span style="color:#b48ead;">let mut</span><span> changing_name = &quot;</span><span style="color:#a3be8c;">bar</span><span>&quot;;
</span><span>changing_name = &quot;</span><span style="color:#a3be8c;">baz</span><span>&quot;;
</span></code></pre>
<p>However, immutable variables can be shadowed:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">let</span><span> name = &quot;</span><span style="color:#a3be8c;">foo</span><span>&quot;;
</span><span style="color:#b48ead;">let</span><span> name = &quot;</span><span style="color:#a3be8c;">bar</span><span>&quot;; </span><span style="color:#65737e;">// shadowed variable
</span></code></pre>
<br/>
### Type inference ðŸ˜Ž
Type inference is great for conciseness:
```rust
// Type can be inferred:
let foo = "foo".to_string();
// or set explicitly:
let foo : String = "foo".to_string();
```
<br/>
### Pattern matching ðŸ˜Ž
<p>Rust has pattern matching... and it's cool!</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">let</span><span> body = </span><span style="color:#b48ead;">match</span><span> body {
</span><span>  Ok(body) =&gt; body,
</span><span>  Err(_) =&gt; &quot;</span><span style="color:#a3be8c;">default</span><span>&quot;
</span><span>}
</span></code></pre>
<p>As far as I understand, variable borrowing makes pattern matching harder to use, as seen in the <a href="https://stackoverflow.com/questions/29926724/matching-string-cannot-move-out-of-borrowed-content">Stack Overflow</a>. Note to self: try this out.</p>
<br/>
### Tuples, enums and structures ðŸ˜Ž
<p>Rust has enums, tuples, and structures:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#![</span><span style="color:#bf616a;">allow</span><span>(dead_code)]
</span><span>
</span><span>#[</span><span style="color:#bf616a;">derive</span><span>(Debug)] </span><span style="color:#b48ead;">enum </span><span>Suite {
</span><span>  </span><span style="color:#d08770;">CLUB</span><span>, </span><span style="color:#d08770;">DIAMOND</span><span>, </span><span style="color:#d08770;">HEART</span><span>, </span><span style="color:#d08770;">SPADE
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">derive</span><span>(Debug)] </span><span style="color:#b48ead;">enum </span><span>Rank {
</span><span>  Ace, King, Queen, Jack
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">derive</span><span>(Debug)] </span><span style="color:#b48ead;">struct </span><span>Card {
</span><span>  </span><span style="color:#bf616a;">suite</span><span>: Suite,
</span><span>  </span><span style="color:#bf616a;">rank</span><span>: Rank,
</span><span>}
</span></code></pre>
<p>Let's test it via the <code>rusti</code> REPL:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>rusti=&gt; Card { suite: Suite::</span><span style="color:#d08770;">CLUB</span><span>, rank: Rank::King }
</span><span>Card { suite: </span><span style="color:#d08770;">CLUB</span><span>, rank: King }
</span></code></pre>
<br/>
## Rust tooling
<br/>
### No REPL (with full Rust support) ðŸ˜¢
<p>There is no official REPL (Read Eval Print Loop), and that's a pity for beginners like me!</p>
<p><a href="https://github.com/murarth/rusti">rusti</a> can help but does not support all recent language changes.</p>
<p>On-line REPLs such as <a href="https://repl.it/site/languages/rust">repl.it</a> can also be handy, even if limited (e.g. cannot import external dependencies aka <code>crates</code>).</p>
<h3 id="concise-dependency-descriptors-cargo-toml-with-semantic-versioning-sunglasses">Concise dependency descriptors (<code>Cargo.toml</code>) with semantic versioning ðŸ˜Ž</h3>
<p>Every cargo binary (aka <code>crate</code>):</p>
<ul>
<li>has a descriptor with a <a href="https://semver.org/">semantic version</a>. For instance, pullpito's version is 0.1.0, as declared in its <code>Cargo.toml</code> descriptor:</li>
</ul>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>pullpito $&gt; grep &quot;^version =&quot; Cargo.toml
</span><span>version = &quot;0.1.0&quot;
</span></code></pre>
<ul>
<li>declares the versions of its own dependencies:</li>
</ul>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>pullpito $&gt; grep -A 10 &quot;dependencies&quot; Cargo.toml
</span><span>[dependencies]
</span><span>log = &quot;0.4&quot;
</span><span>env_logger = &quot;0.5&quot;
</span><span>futures = &quot;0.1&quot;
</span><span>serde = &quot;1.0&quot;
</span><span>serde_json = &quot;1.0&quot;
</span><span>serde_derive = &quot;1.0&quot;
</span><span>chrono = { version = &quot;0.4&quot;, features = [&quot;serde&quot;] }
</span><span>reqwest = &quot;0.8&quot;
</span></code></pre>
<p>Cool and concise, isn't it?</p>
<br/>
### Standard code format ðŸ˜Ž
<p><a href="https://github.com/rust-lang-nursery/rustfmt">rustfmt</a> can be used as a command-line tool to format code using a default style:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>pullpito $&gt; cat src/main.rs
</span><span>fn main() {
</span><span>  println! (&quot;foo&quot;);
</span><span> let bar = &quot;bar&quot;;
</span><span>}
</span><span>
</span><span>pullpito $&gt; cargo fmt
</span><span>
</span><span>pullpito $&gt; cat src/main.rs
</span><span>fn main() {
</span><span>    println!(&quot;foo&quot;);
</span><span>    let bar = &quot;bar&quot;;
</span><span>}
</span></code></pre>
<p>No more "tabs vs space vs ..." flame war! Cf. <a href="https://xkcd.com/1285/">https://xkcd.com/1285/</a>!</p>
<br/>
### User-friendly compiler (mostly) ðŸ˜Ž
<p>The Rust compiler often makes useful suggestions in case of compilation error. Example:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">derive</span><span>(Debug)] </span><span style="color:#b48ead;">enum </span><span>Suite { </span><span style="color:#d08770;">CLUB </span><span>}
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span>    println!(&quot;</span><span style="color:#d08770;">{:?}</span><span>&quot;, Suite.</span><span style="color:#d08770;">CLUB</span><span>);
</span><span>}
</span></code></pre>
<p>will fail compiling:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>error[E0423]: expected value, found enum `Suite`
</span><span> --&gt; src/main.rs:5:22
</span><span>  |
</span><span>5 |     println!(&quot;{:?}&quot;, Suite.CLUB);
</span><span>  |                      ^^^^^
</span><span>  |
</span><span>  = note: did you mean to use one of the following variants?
</span><span>          - `Suite::CLUB`
</span></code></pre>
<br/>
### A multi-version toolchain: `rustup` ðŸ˜Ž
<p>Rust has three release channels: stable, beta, and nightly. You can natively install and use one, some or all of them. Indeed, some libraries or tools may only work on the "stable" toolchain, and others may require the "nightly" one. In that case, use the <code>rustup</code> command to install and use both toolchains.</p>
<p>For instance, I can install the <code>nightly</code> toolchain:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>$&gt; rustup install nightly
</span></code></pre>
<p>There are now two toolchains: <code>stable</code> and <code>nightly</code>:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>$&gt; rustup show
</span><span>Default host: x86_64-apple-darwin
</span><span>
</span><span>installed toolchains
</span><span>--------------------
</span><span>
</span><span>stable-x86_64-apple-darwin
</span><span>nightly-x86_64-apple-darwin
</span><span>
</span><span>active toolchain
</span><span>----------------
</span><span>
</span><span>stable-x86_64-apple-darwin (default)
</span><span>rustc 1.25.0 (84203cac6 2018-03-25)
</span></code></pre>
<p>I can then:</p>
<ul>
<li>change the default toolchain via <code>rustup default</code></li>
<li>set the active toolchain via <code>rustup set</code></li>
<li>use it on demand via <code>rustup run $toolchain $cmd</code> (example: <code>rustup run nightly cargo build</code>)</li>
</ul>
<p>etc.</p>

        </section>
    </article>
</main>



        
            
        

        
    </div>
</body>

</html>
